getUnicLicensesName
SELECT Code FROM Software


getDataOfUsersUseLicenses
SELECT
(
	SELECT u.Name
	FROM Users u
	WHERE u.UserID = h.UserID
) AS UserName,
(
	SELECT u.Host
	FROM Users u
	WHERE u.UserID = h.UserID
) AS UserHost,
(
	SELECT s.Code
	FROM Software s
	WHERE s.SoftwareID = h.SoftwareID
) AS SoftWare
FROM History h


getNumberOfPurchasedLicenses
SELECT Code, NumberOfPurchased FROM Software


getPartsInPersentOfPurchasedLicenses
SELECT Code, AmountOfInvestments FROM Software


getAvgLicesensePerTime
SELECT AVG(newTable.licenseCount) 
FROM
(
	SELECT COUNT(*) AS licenseCount 
	FROM History h 
	WHERE h.SoftwareID=
	(
		SELECT s.SoftwareID
		FROM Software s
		WHERE s.Code='85787BDSPRM_F'
	) AND h.DateIN is not null 
	GROUP BY Year(h.DateIN)
) as newTable


getDataOfUseAllLicenses
SELECT 
(
	SELECT COUNT(*) 
	FROM History hh 
	WHERE hh.SoftwareID=
	(
		SELECT SoftwareID
		FROM Software s
		WHERE s.Code='85787BDSPRM_F'
	) AND YEAR(hh.DateIN) = YEAR(h.DateIN)  AND MONTH(hh.DateIN) =  MONTH(h.DateIN) AND DAY(hh.DateIN) =  DAY(h.DateIN) AND DATEPART(hour,hh.TimeIN) = DATEPART(hour,h.TimeIN)
),
(
	SELECT COUNT(*) 
	FROM History hh 
	WHERE hh.SoftwareID=
	(
		SELECT SoftwareID
		FROM Software s
		WHERE s.Code='86071BDSPRM_2014_0F'
	) AND YEAR(hh.DateIN) = YEAR(h.DateIN)  AND MONTH(hh.DateIN) =  MONTH(h.DateIN) AND DAY(hh.DateIN) =  DAY(h.DateIN) AND DATEPART(hour,hh.TimeIN) = DATEPART(hour,h.TimeIN)
)
FROM History h 
WHERE h.TimeIN IS NOT NULL 
GROUP BY DATEPART(hour,h.TimeIN), DAY(h.DateIN), MONTH(h.DateIN), YEAR(h.DateIN) 
ORDER BY YEAR(h.DateIN), MONTH(h.DateIN), DAY(h.DateIN), DATEPART(hour,h.TimeIN)


getTimesGiveLicense
SELECT YEAR(h.DateIN)*8640+MONTH(h.DateIN)*720+DAY(h.DateIN)*24+DATEPART(hour,h.TimeIN)
FROM History h 
WHERE h.DateIN is not null AND h.SoftwareID=
(
	SELECT SoftwareID
	FROM Software s
	WHERE s.Code='85787BDSPRM_F'
) AND h.UserID!=
(
	SELECT UserID
	FROM Users u
	Where u.Name = 'RevitSystem' 
)
ORDER BY YEAR(h.DateIN), MONTH(h.DateIN), DAY(h.DateIN), DATEPART(hour,h.TimeIN)


getInBetweenOutLicenses
SELECT (YEAR(h.DateExit)-YEAR(h.DateIN))*8640+(MONTH(h.DateExit)-MONTH(h.DateIN))*720+(DAY(h.DateExit)-DAY(h.DateIN))*24+DATEPART(hour,h.TimeExit)-DATEPART(hour,h.TimeIN) 
FROM History h 
WHERE  h.DateIN is not null AND h.DateExit is not null AND h.SoftwareID=
(
	SELECT SoftwareID
	FROM Software s
	WHERE s.Code='85787BDSPRM_F'
) AND h.UserID!=
(
	SELECT UserID
	FROM Users u
	Where u.Name = 'RevitSystem' 
) AND (YEAR(h.DateExit)-YEAR(h.DateIN))*8640+(MONTH(h.DateExit)-MONTH(h.DateIN))*720+(DAY(h.DateExit)-DAY(h.DateIN))*24+DATEPART(hour,h.TimeExit)-DATEPART(hour,h.TimeIN)  != 0 
ORDER BY YEAR(h.DateIN), MONTH(h.DateIN), DAY(h.DateIN), DATEPART(hour,h.TimeIN)


getNumberOfLicenesForTime
SELECT COUNT(*)
FROM History h
WHERE YEAR(h.DateIN) != 0 AND YEAR(h.DateExit) != 0 AND h.SoftwareID=
(
	SELECT SoftwareID
	FROM Software s
	WHERE s.Code='85787BDSPRM_F'
)
GROUP BY YEAR(h.DateIN), MONTH(h.DateIN), DAY(h.DateIN), DATEPART(hour,h.TimeIN)